# -----------------------------------------------------------------------------
# scons configuration for public MakerVR documentation using Doxygen.
#
# Targets:
#    - Doc [DEFAULT]
#          Generates internal Doxygen documentation in "doxygen" directory.
# -----------------------------------------------------------------------------

Import('doc_build_dir', 'APP_NAME', 'VERSION_STRING')

env = Environment(
    ABS_BUILD_DIR = Dir(f'#{doc_build_dir}').abspath,
    OUTPUT_DIR    = '$ABS_BUILD_DIR/PublicDoc',
    DOXYGEN       = '/local/inst/doxygen-1.9.3/bin/doxygen',
)

# Set up environment variables for Doxyfile to access.
output_dir = env.subst('$OUTPUT_DIR') + '/site/' + VERSION_STRING

env.Append(
    ENV = {
        'APP_NAME'         : APP_NAME,
        'VERSION_STRING'   : VERSION_STRING,
        'INPUT_DIRECTORY'  : 'docs',
        'OUTPUT_DIRECTORY' : output_dir,
    }
)
# Doc depends on everything under the 'docs' directory. This returns paths to
# all files under the given root directory.
def GetAllFiles(root_dir):
    paths = []
    from os      import walk
    from os.path import isfile, join
    for root, dirs, files in walk(root_dir):
        for f in files:
            path = join(root, f)
            if isfile(path):
                paths.append(path)
    return paths

sources = GetAllFiles('docs')
doc = env.Command('$OUTPUT_DIR/site/$VERSION_STRING/index.html', sources,
                  'mkdocs build', chdir='PublicDoc')

Return('doc')
